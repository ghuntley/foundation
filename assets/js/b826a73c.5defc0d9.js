"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[413],{4297:function(e,t,n){n.r(t),n.d(t,{assets:function(){return b},contentTitle:function(){return k},default:function(){return N},frontMatter:function(){return h},metadata:function(){return f},toc:function(){return w}});var a=n(7462),o=n(3366),r=n(7294),s=n(3905),l=n(2389),i=n(3725),u=n(6010),p="tabItem_LplD";function d(e){var t,n,o,s=e.lazy,l=e.block,d=e.defaultValue,c=e.values,m=e.groupId,v=e.className,g=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=c?c:g.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),k=(0,i.lx)(h,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var f=null===d?d:null!=(t=null!=d?d:null==(n=g.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(o=g[0])?void 0:o.props.value;if(null!==f&&!h.some((function(e){return e.value===f})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+f+'" but none of its children has the corresponding value. Available values are: '+h.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var b=(0,i.UB)(),w=b.tabGroupChoices,y=b.setTabGroupChoices,N=(0,r.useState)(f),S=N[0],x=N[1],C=[],A=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var E=w[m];null!=E&&E!==S&&h.some((function(e){return e.value===E}))&&x(E)}var T=function(e){var t=e.currentTarget,n=C.indexOf(t),a=h[n].value;a!==S&&(A(t),x(a),null!=m&&y(m,a))},I=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=C.indexOf(e.currentTarget)+1;n=C[a]||C[0];break;case"ArrowLeft":var o=C.indexOf(e.currentTarget)-1;n=C[o]||C[C.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":l},v)},h.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:S===t?0:-1,"aria-selected":S===t,key:t,ref:function(e){return C.push(e)},onKeyDown:I,onFocus:T,onClick:T},o,{className:(0,u.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":S===t})}),null!=n?n:t)}))),s?(0,r.cloneElement)(g.filter((function(e){return e.props.value===S}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},g.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==S})}))))}function c(e){var t=(0,l.Z)();return r.createElement(d,(0,a.Z)({key:String(t)},e))}function m(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}var v=n(1736),g=["components"],h={sidebar_position:5},k="Deploy to Production",f={unversionedId:"getting-started/deployment",id:"getting-started/deployment",title:"Deploy to Production",description:"Deploying to the Local dev Environment",source:"@site/docs/getting-started/deployment.mdx",sourceDirName:"getting-started",slug:"/getting-started/deployment",permalink:"/getting-started/deployment",editUrl:"https://github.com/namespacelabs/docs/tree/main/docs/getting-started/deployment.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"sidebar",previous:{title:"Testing",permalink:"/getting-started/testing"},next:{title:"Package System",permalink:"/concepts/package"}},b={},w=[{value:"Deploying to the Local <code>dev</code> Environment",id:"deploying-to-the-local-dev-environment",level:2},{value:"Deploying to AWS/EKS",id:"deploying-to-awseks",level:2},{value:"Install and Configure the AWS CLI",id:"install-and-configure-the-aws-cli",level:3},{value:"Setting up AWS SSO",id:"setting-up-aws-sso",level:4},{value:"Setting up an AWS CLI profile for a given AWS SSO account",id:"setting-up-an-aws-cli-profile-for-a-given-aws-sso-account",level:4},{value:"Configure the EKS Cluster",id:"configure-the-eks-cluster",level:3},{value:"Configure your <code>prod</code> Cluster",id:"configure-your-prod-cluster",level:3},{value:"Login to nscloud.dev",id:"login-to-nsclouddev",level:3},{value:"Deploy to the <code>prod</code> Environment",id:"deploy-to-the-prod-environment",level:3}],y={toc:w};function N(e){var t=e.components,n=(0,o.Z)(e,g);return(0,s.kt)("wrapper",(0,a.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"deploy-to-production"},"Deploy to Production"),(0,s.kt)("h2",{id:"deploying-to-the-local-dev-environment"},"Deploying to the Local ",(0,s.kt)("inlineCode",{parentName:"h2"},"dev")," Environment"),(0,s.kt)("p",null,"By default deploys to the local ",(0,s.kt)("inlineCode",{parentName:"p"},"dev")," environment (k3s cluster)."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"ns deploy api/server\n")),(0,s.kt)("h2",{id:"deploying-to-awseks"},"Deploying to AWS/EKS"),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"We've optimized Early Access for deployment to AWS EKS."))),(0,s.kt)("h3",{id:"install-and-configure-the-aws-cli"},"Install and Configure the AWS CLI"),(0,s.kt)(c,{mdxType:"Tabs"},(0,s.kt)(m,{value:"Linux x86",label:"Linux x86 (64-bit)",default:!0,mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"\n$ unzip awscliv2.zip\n$ sudo ./aws/install\n'))),(0,s.kt)(m,{value:"Linux ARM",label:"Linux ARM",default:!0,mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ curl "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" -o "awscliv2.zip"\n$ unzip awscliv2.zip\n$ sudo ./aws/install\n'))),(0,s.kt)(m,{value:"Mac",label:"Mac",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"\n$ sudo installer -pkg AWSCLIV2.pkg -target /\n')))),(0,s.kt)("h4",{id:"setting-up-aws-sso"},"Setting up AWS SSO"),(0,s.kt)("p",null,"An ",(0,s.kt)("a",{parentName:"p",href:"https://aws.amazon.com/single-sign-on/"},"AWS SSO")," account represents a person with access to a set of\nAWS accounts, where each AWS account is an aggregation of AWS resources. After you login with SSO,\nyou have the opportunity to act as any of the AWS accounts you have access to, either through the management console,\nor using programmatic credentials. "),(0,s.kt)("p",null,"It's prudent  to note that programmatic access is session based, and the credentials you get in the SSO portal are valid for 12 hours (then they need to be refreshed)."),(0,s.kt)("h4",{id:"setting-up-an-aws-cli-profile-for-a-given-aws-sso-account"},"Setting up an AWS CLI profile for a given AWS SSO account"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ aws configure --profile [AWS-PROFILE-NAME] sso\nSSO start URL [None]: https://yourdomain.awsapps.com/start\nSSO Region [None]: eu-west-1\n(...)\nThere are x AWS accounts available to you.\nUsing the account ID 980098925158\nThe only role available to you is: root\nUsing the role name "root"\nCLI default client Region [None]: us-east-2\nCLI default output format [None]:\n...\n')),(0,s.kt)("h3",{id:"configure-the-eks-cluster"},"Configure the EKS Cluster"),(0,s.kt)("p",null,"Install ",(0,s.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html"},"eksctl")," if needed."),(0,s.kt)("p",null,"Please ensure that you specify ",(0,s.kt)("em",{parentName:"p"},"--profile ","[AWS-PROFILE-NAME]")," if you have set up an AWS account profile. "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# Create cluster "zerotwo" in the "eu-west-1" region.\n$ eksctl create cluster -n zerotwo -r eu-west-1 --profile [AWS-PROFILE-NAME]\n\n# Or, if you already have a cluster, update the k8s config.\n$ aws eks update-kubeconfig --region eu-west-1 --name zerotwo --profile [AWS-PROFILE-NAME]\n')),(0,s.kt)("h3",{id:"configure-your-prod-cluster"},"Configure your ",(0,s.kt)("inlineCode",{parentName:"h3"},"prod")," Cluster"),(0,s.kt)("p",null,"Previously we were working with the default ",(0,s.kt)("inlineCode",{parentName:"p"},"dev")," environment, which is pre-configured to run the\nservers in a local k3s cluster. To deploy servers in production, we need to configure another\nbuilt-in environment: ",(0,s.kt)("inlineCode",{parentName:"p"},"prod"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ns prepare --env=prod --context=awsuser@zerotwo.eu-west-1.eksctl.io --aws_profile=default\n")),(0,s.kt)("p",null,"Replace ",(0,s.kt)("inlineCode",{parentName:"p"},"awsuser@zerotwo.eu-west-1.eksctl.io")," with the right context from ",(0,s.kt)("inlineCode",{parentName:"p"},"kubectl config get-contexts"),"."),(0,s.kt)("h3",{id:"login-to-nsclouddev"},"Login to nscloud.dev"),(0,s.kt)("p",null,"Namespace automatically manages nscloud.dev -based sub-domains and issues SSL certificates for\ndeployed servers on our behalf. To use these features, we need to login to Namespace using a Github\naccount:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ns login\n")),(0,s.kt)("h3",{id:"deploy-to-the-prod-environment"},"Deploy to the ",(0,s.kt)("inlineCode",{parentName:"h3"},"prod")," Environment"),(0,s.kt)("p",null,"Now we are ready to deploy the servers to the configured AWS Kubernetes cluster:"),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"ns deploy --env=prod web/server api/server"))),(0,s.kt)(v.Z,{language:"bash",mdxType:"CodeBlock"},(0,s.kt)("pre",null,"Servers deployed:",(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"[\u2713] namespacelabs.dev/examples/todos/api/server took 1.8s\n[\u2713] namespacelabs.dev/foundation/std/monitoring/grafana/server (no updated required)\n[\u2713] namespacelabs.dev/foundation/std/monitoring/jaeger (no updated required)\n[\u2713] namespacelabs.dev/universe/db/postgres/server (no updated required)\n[\u2713] namespacelabs.dev/foundation/std/monitoring/prometheus/server (no updated required)\n[\u2713] namespacelabs.dev/examples/todos/web/server took 206ms\n")),(0,s.kt)("p",null,"Services deployed:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"[\u2713] Jaeger/collector  container port 14268       # namespacelabs.dev/foundation/std/monitoring/jaeger\n[\u2713] Jaeger/frontend  http container port 16686  # namespacelabs.dev/foundation/std/monitoring/jaeger\n[\u2713] postgresql/postgres  container port 5432        # namespacelabs.dev/universe/db/postgres/server\n[\u2713] Prometheus/prometheus  http container port 9090   # namespacelabs.dev/foundation/std/monitoring/prometheus/server\n[\u2713] Grafana/web  http container port 3000   # namespacelabs.dev/foundation/std/monitoring/grafana/server\n\n[\u2713] api-backend/grpc-gateway  http container port 40001  # namespacelabs.dev/examples/todos/api/server\n[\u2713] web-server/http  http container port 80     # namespacelabs.dev/examples/todos/web/server\n[\u2713] todos  grpc container port 40000  # namespacelabs.dev/examples/todos/api/todos\n[\u2713] trends  grpc container port 40000  # namespacelabs.dev/examples/todos/api/trends\n")),(0,s.kt)("p",null,"Ingress deployed:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"[\u2713] grpc-gateway-1088nk7bp49rpynz6hqshk6epx.prod.username.nscloud.dev # namespacelabs.dev/examples/todos/api/server\n[\u2713] todos-grpc.prod.username.nscloud.dev                              # namespacelabs.dev/examples/todos/api/server\n[\u2713] web-server.prod.username.nscloud.dev                              # namespacelabs.dev/examples/todos/web/server\n")),(0,s.kt)("p",null,"Next steps:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"\xb7 You can inspect server logs using ns logs --env=prod api/server.\n\xb7 Track your deployment with `kubectl -n prod-examples/todos-sdtan get pods`.\n\xb7 Try out a stateful development session with ns dev --env=prod api/server\n")),(0,s.kt)("p",null,"Next steps:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"\xb7 You can inspect server logs using ns logs --env=prod web/server.\n\xb7 Track your deployment with `kubectl -n prod-examples/todos-sdtan get pods`.\n\xb7 Try out a stateful development session with ns dev --env=prod web/server\n"))))),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"ns")," printed a URL of our Web server in production: ",(0,s.kt)("inlineCode",{parentName:"p"},"https://web-server.prod.username.nscloud.dev"),"\n(",(0,s.kt)("inlineCode",{parentName:"p"},"username")," will be replaced with the github account name used in ",(0,s.kt)("inlineCode",{parentName:"p"},"ns login"),"). Success!"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Hopefully you've had fun trying out Namespace. We'd love to hear what you think!")))}N.isMDXComponent=!0}}]);